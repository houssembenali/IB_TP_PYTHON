

task purge(type:Delete) {
  delete 'build'
}

task dependances(type:Exec, dependsOn: purge) {
    executable 'sh'
    args '-c', 'pip3 install flask'
    standardOutput = new ByteArrayOutputStream()
    ext.output = { return standardOutput.toString() }
}

def tarfile = "application-" + project.version

task packageDistribution(type: Zip, dependsOn: dependances) {
    from ('script') { into '.' }
    archiveFileName = tarfile + ".zip"
    destinationDirectory = file("build")
}

task up(type:Exec, dependsOn: packageDistribution) {
 executable 'sh'
 args '-c', 'curl -v --user "admin:azerty" --upload-file ./build/'+tarfile+'.zip http://192.168.1.144:8081/repository/nexus-tpp/application-python/'+tarfile+'.zip'
 standardOutput = new ByteArrayOutputStream()
 ext.output = { return standardOutput.toString() }
}

